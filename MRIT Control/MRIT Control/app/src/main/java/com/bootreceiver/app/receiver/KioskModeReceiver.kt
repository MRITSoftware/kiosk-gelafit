package com.bootreceiver.app.receiverimport android.content.BroadcastReceiverimport android.content.Contextimport android.content.Intentimport android.util.Logimport com.bootreceiver.app.utils.AppLauncherimport com.bootreceiver.app.utils.DeviceIdManagerimport com.bootreceiver.app.utils.PreferenceManagerimport com.bootreceiver.app.utils.SupabaseManagerimport kotlinx.coroutines.CoroutineScopeimport kotlinx.coroutines.Dispatchersimport kotlinx.coroutines.Jobimport kotlinx.coroutines.launch/** * BroadcastReceiver que intercepta eventos do sistema para prevenir minimiza├º├úo * quando o modo kiosk est├í ativo */class KioskModeReceiver : BroadcastReceiver() {        override fun onReceive(context: Context, intent: Intent) {        when (intent.action) {            Intent.ACTION_CLOSE_SYSTEM_DIALOGS -> {                // Intercepta quando o usu├írio tenta abrir menu do sistema                Log.d(TAG, "­ƒöÆ Menu do sistema interceptado")                                // Verifica se kiosk est├í ativo e reabre app se necess├írio                checkAndReopenApp(context)            }            "android.intent.action.USER_PRESENT" -> {                // Quando o usu├írio desbloqueia a tela                checkAndReopenApp(context)            }            Intent.ACTION_SCREEN_ON -> {                // Quando a tela liga                checkAndReopenApp(context)            }        }    }        private fun checkAndReopenApp(context: Context) {        CoroutineScope(Dispatchers.IO + Job()).launch {            try {                val deviceId = DeviceIdManager.getDeviceId(context)                val supabaseManager = SupabaseManager()                val kioskMode = supabaseManager.getKioskMode(deviceId)                                if (kioskMode == true) {                    val preferenceManager = PreferenceManager(context)                    val targetPackage = preferenceManager.getTargetPackageName()                                        if (!targetPackage.isNullOrEmpty()) {                        Log.d(TAG, "­ƒöÆ Kiosk ativo - garantindo que app est├í em foreground")                        val appLauncher = AppLauncher(context)                        appLauncher.launchApp(targetPackage)                    }                }            } catch (e: Exception) {                Log.e(TAG, "Erro ao verificar kiosk: ${e.message}", e)            }        }    }        companion object {        private const val TAG = "KioskModeReceiver"    }}