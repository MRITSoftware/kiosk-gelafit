# Servidor Tuya Local - Guia para Tablet

## Opções para Rodar no Tablet

### Opção 1: **Termux (Android) - RECOMENDADO** ⭐

**Vantagens:**
- Fácil de instalar e usar
- Terminal completo com Python
- Pode rodar em background
- Acesso root não necessário

**Passos:**

1. **Instalar Termux:**
   - Baixe do F-Droid (recomendado) ou Play Store
   - Abra o Termux

2. **Instalar dependências:**
   ```bash
   pkg update && pkg upgrade
   pkg install python git
   pip install flask tinytuya
   ```

3. **Transferir arquivos:**
   - Use `scp` ou copie os arquivos para `/data/data/com.termux/files/home/`
   - Ou clone do git se tiver o código versionado

4. **Rodar o servidor:**
   ```bash
   python tuya_server.py
   ```

5. **Manter rodando em background:**
   ```bash
   # Usando nohup
   nohup python tuya_server.py > server.log 2>&1 &
   
   # Ou usando tmux (instalar: pkg install tmux)
   tmux new -d -s tuya 'python tuya_server.py'
   ```

6. **Ver logs:**
   ```bash
   tail -f server.log
   # ou
   tmux attach -t tuya
   ```

---

### Opção 2: **Pydroid 3 (Android)**

**Vantagens:**
- Interface gráfica amigável
- Editor de código integrado
- Fácil de usar

**Desvantagens:**
- Pode ter limitações de rede/permissões
- Menos controle sobre processos em background

**Passos:**

1. Instale o Pydroid 3 da Play Store
2. Abra o app e instale as dependências:
   - Vá em "Pip" → instale `flask` e `tinytuya`
3. Copie o código para o app
4. Execute o script

---

### Opção 3: **Pythonista (iOS)**

**Vantagens:**
- Funciona bem no iPad
- Interface boa

**Desvantagens:**
- App pago
- Limitações de rede podem existir

---

### Opção 4: **Servidor Linux (via SSH)**

Se o tablet tiver acesso SSH a um servidor Linux:

1. Conecte via SSH
2. Instale Python e dependências
3. Rode o servidor normalmente
4. Use `systemd` ou `supervisord` para manter rodando

---

## Melhorias Recomendadas para Tablet

### 1. **Adicionar Auto-start**

Crie um script de inicialização:

```bash
#!/bin/bash
# start_tuya.sh
cd /caminho/para/o/script
python3 tuya_server.py
```

### 2. **Usar systemd (se disponível)**

Crie um serviço systemd para iniciar automaticamente.

### 3. **Adicionar Interface Web Simples**

Você pode adicionar uma página HTML simples para monitorar o status:

```python
@app.route("/", methods=["GET"])
def index():
    return """
    <html>
        <head><title>Tuya Server - {}</title></head>
        <body>
            <h1>Servidor Tuya Local</h1>
            <p>Site: {}</p>
            <p>Status: <a href="/health">Verificar Health</a></p>
        </body>
    </html>
    """.format(SITE_NAME, SITE_NAME)
```

### 4. **Melhorar Logging**

Adicione logs em arquivo:

```python
import logging

logging.basicConfig(
    filename='tuya_server.log',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
```

---

## Configuração de Rede

**Importante:**
- O tablet precisa estar na mesma rede Wi-Fi dos dispositivos Tuya
- A porta 8000 precisa estar acessível na rede local
- Alguns tablets podem ter firewall - verifique as configurações

---

## Testando

Após iniciar o servidor, teste com:

```bash
# No tablet ou outro dispositivo na mesma rede
curl http://IP_DO_TABLET:8000/health

# Exemplo de comando
curl -X POST http://IP_DO_TABLET:8000/tuya/command \
  -H "Content-Type: application/json" \
  -d '{"action":"on","tuya_device_id":"...","local_key":"...","lan_ip":"..."}'
```

---

## Troubleshooting

1. **Porta já em uso:** Mude a porta no código (ex: 8001)
2. **Firewall bloqueando:** Desative firewall temporariamente ou adicione exceção
3. **Python não encontrado:** Use `python3` ao invés de `python`
4. **Dependências faltando:** Execute `pip install -r requirements.txt`

