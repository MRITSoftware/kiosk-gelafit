# üß™ Guia de Teste - Sistema PHP

## üìã Checklist de Testes

### 1. Teste Local (se tiver PHP instalado)

#### Op√ß√£o A: Via Linha de Comando
```bash
cd php-version
php test.php
```

#### Op√ß√£o B: Via Servidor PHP Local
```bash
cd php-version
php -S localhost:8000
```
Depois acesse: http://localhost:8000/test.php

### 2. Teste na HostGator

#### Passo 1: Instalar Depend√™ncias

**Via SSH (se dispon√≠vel):**
```bash
cd public_html
composer install --no-dev --optimize-autoloader
```

**Ou localmente e enviar:**
```bash
# No seu computador
cd php-version
composer install --no-dev --optimize-autoloader
# Depois envie a pasta vendor/ via FTP
```

#### Passo 2: Configurar Banco de Dados

1. Edite `config/database.php` com suas credenciais:
```php
'host' => 'localhost',
'database' => 'seu_banco',
'username' => 'seu_usuario',
'password' => 'sua_senha',
```

2. Acesse via navegador: `https://seudominio.com.br/test.php`
   - O sistema criar√° as tabelas automaticamente

#### Passo 3: Testar Endpoints da API

**Teste 1: Cadastro de Cliente**
```bash
curl -X POST https://seudominio.com.br/api/auth/cadastro.php \
  -H "Content-Type: application/json" \
  -d '{"cpf":"12345678901","nome":"Teste","email":"teste@teste.com"}'
```

**Resposta esperada:**
```json
{
  "success": true,
  "message": "Cadastro realizado com sucesso!",
  "clienteId": 1,
  "isNew": true,
  "token": "eyJ..."
}
```

**Teste 2: Login**
```bash
curl -X POST https://seudominio.com.br/api/auth/login.php \
  -H "Content-Type: application/json" \
  -d '{"cpf":"12345678901"}' \
  -c cookies.txt
```

**Resposta esperada:**
```json
{
  "success": true,
  "message": "Login realizado com sucesso!",
  "token": "eyJ...",
  "cliente": {
    "id": 1,
    "nome": "Teste",
    "cpf": "123.456.789-01",
    "email": "teste@teste.com"
  }
}
```

**Teste 3: Verificar Cliente (com cookie)**
```bash
curl -X GET https://seudominio.com.br/api/clientes/me.php \
  -b cookies.txt
```

**Resposta esperada:**
```json
{
  "success": true,
  "cliente": {
    "id": 1,
    "nome": "Teste",
    "cpf": "123.456.789-01",
    "email": "teste@teste.com",
    "creditos_assinatura": 1,
    "ilimitado": false
  }
}
```

**Teste 4: Verificar Cr√©ditos**
```bash
curl -X GET https://seudominio.com.br/api/creditos/verificar.php \
  -b cookies.txt
```

**Resposta esperada:**
```json
{
  "success": true,
  "creditos": 1,
  "ilimitado": false
}
```

### 3. Teste com Postman/Insomnia

#### Configura√ß√£o Base
- **Base URL**: `https://seudominio.com.br`
- **Headers**: `Content-Type: application/json`

#### Cole√ß√£o de Requisi√ß√µes

**1. Cadastro**
- **Method**: POST
- **URL**: `/api/auth/cadastro.php`
- **Body** (JSON):
```json
{
  "cpf": "12345678901",
  "nome": "Teste",
  "email": "teste@teste.com"
}
```

**2. Login**
- **Method**: POST
- **URL**: `/api/auth/login.php`
- **Body** (JSON):
```json
{
  "cpf": "12345678901"
}
```
- **Configurar**: Salvar cookie `auth-token` automaticamente

**3. Obter Cliente**
- **Method**: GET
- **URL**: `/api/clientes/me.php`
- **Cookies**: Usar cookie salvo do login

**4. Verificar Cr√©ditos**
- **Method**: GET
- **URL**: `/api/creditos/verificar.php`
- **Cookies**: Usar cookie salvo do login

### 4. Teste de Banco de Dados

#### Verificar Tabelas Criadas

Acesse o phpMyAdmin da HostGator e verifique se as seguintes tabelas foram criadas:

- ‚úÖ `clientes`
- ‚úÖ `documentos`
- ‚úÖ `codigos_assinatura`
- ‚úÖ `assinantes_codigo`
- ‚úÖ `assinaturas`
- ‚úÖ `pagamentos`
- ‚úÖ `auditoria_assinaturas`

#### Teste de Inser√ß√£o

Execute via phpMyAdmin ou via API:
```sql
INSERT INTO clientes (nome, cpf, email, creditos_assinatura) 
VALUES ('Teste', '12345678901', 'teste@teste.com', 1);
```

Depois teste o login com esse CPF.

### 5. Teste de Seguran√ßa

#### Verificar JWT
1. Fa√ßa login e copie o token
2. Acesse: https://jwt.io
3. Cole o token e verifique se:
   - O payload cont√©m `id` e `cpf`
   - A expira√ß√£o est√° correta (7 dias)
   - A assinatura √© v√°lida

#### Verificar Cookies
- Cookie `auth-token` deve ter:
  - `HttpOnly`: true
  - `Secure`: true (em HTTPS)
  - `SameSite`: Lax

### 6. Verificar Logs de Erro

Na HostGator, verifique os logs de erro:
- Via painel: Logs ‚Üí Error Log
- Ou via FTP: `logs/error_log`

Procure por erros relacionados a:
- Conex√£o com banco de dados
- Classes n√£o encontradas
- Erros de sintaxe PHP

## üêõ Troubleshooting

### Erro: "Class not found"
**Solu√ß√£o**: Execute `composer install` novamente

### Erro: "Connection refused" no banco
**Solu√ß√£o**: Verifique credenciais em `config/database.php`

### Erro: "Cookie not set"
**Solu√ß√£o**: Verifique se est√° usando HTTPS e se o cookie est√° sendo definido

### Erro 500 Internal Server Error
**Solu√ß√£o**: 
1. Verifique logs de erro
2. Verifique permiss√µes de arquivos
3. Verifique se todas as extens√µes PHP est√£o instaladas

## ‚úÖ Checklist Final

Antes de considerar os testes conclu√≠dos, verifique:

- [ ] Script `test.php` executa sem erros
- [ ] Conex√£o com banco de dados funciona
- [ ] Tabelas foram criadas automaticamente
- [ ] Endpoint de cadastro funciona
- [ ] Endpoint de login funciona
- [ ] Token JWT √© gerado corretamente
- [ ] Cookie √© definido corretamente
- [ ] Endpoint de verificar cr√©ditos funciona
- [ ] Endpoint de obter cliente funciona
- [ ] Logs n√£o mostram erros cr√≠ticos

## üìù Notas

- O sistema cria as tabelas automaticamente na primeira conex√£o
- Todos os endpoints retornam JSON
- Autentica√ß√£o √© feita via cookie `auth-token`
- O sistema est√° pronto para produ√ß√£o ap√≥s configurar:
  - JWT_SECRET (altere o valor padr√£o!)
  - Credenciais do banco de dados
  - Token do Mercado Pago

---

**Pr√≥ximos Passos**: Ap√≥s testar, continue com:
1. Criar p√°ginas frontend (HTML/PHP)
2. Completar implementa√ß√£o de PDFSigner
3. Migrar demais endpoints da API

