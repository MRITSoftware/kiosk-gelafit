# Rastreamento de Status do Cache - Player MRIT

## Funcionalidade Implementada

Agora o sistema atualiza automaticamente o campo `cache` na tabela `displays` quando o cache estiver pronto.

## Como Funciona

### 1. **Atualiza√ß√£o Autom√°tica**
- ‚úÖ Quando o cache √© preenchido ‚Üí `cache = true`
- ‚úÖ Quando a tela sai de uso ‚Üí `cache = false`
- ‚úÖ Atualiza√ß√£o em tempo real no banco de dados

### 2. **Momentos de Atualiza√ß√£o**
- **Cache pronto**: Ap√≥s preencher o cache da playlist
- **Cache direto**: Ap√≥s baixar v√≠deos para IndexedDB
- **Service Worker**: Quando SW notifica cache atualizado
- **Sair de uso**: Quando usu√°rio sai da tela

## Comandos de Debug

### Verificar Status Atual
```javascript
// Verificar status do cache no banco:
mritDebug.verificarStatusCacheBanco();
```

### For√ßar Status
```javascript
// Marcar como pronto:
mritDebug.forcarStatusCache(true);

// Marcar como n√£o pronto:
mritDebug.forcarStatusCache(false);
```

### Verificar Cache Local
```javascript
// Verificar caches locais:
mritDebug.checkAllCache();
mritDebug.verificarTodosCachesSW();
```

## Fluxo Completo

### 1. **Entrada na Tela**
```javascript
// 1. Usu√°rio digita c√≥digo
// 2. Sistema carrega playlist
// 3. Cache √© preenchido automaticamente
// 4. Campo 'cache' √© atualizado para 'true'
```

### 2. **Sa√≠da da Tela**
```javascript
// 1. Usu√°rio sai da tela
// 2. Sistema limpa cache local
// 3. Campo 'cache' √© atualizado para 'false'
```

## Logs de Debug

O sistema mostra logs detalhados:

```
üîÑ Atualizando status do cache para ABC123: pronto
‚úÖ Status do cache atualizado: pronto
üì¶ Cache atualizado pelo Service Worker
üìä Status do cache no banco: ‚úÖ Pronto
```

## Estrutura do Banco

### Tabela `displays`
```sql
-- Campo adicionado:
cache BOOLEAN DEFAULT FALSE
```

### Valores Poss√≠veis
- `true` - Cache pronto e funcionando
- `false` - Cache n√£o dispon√≠vel ou limpo

## Teste Completo

### 1. **Preparar Ambiente**
```javascript
// Verificar Service Worker:
mritDebug.verificarSW();

// Verificar status inicial:
mritDebug.verificarStatusCacheBanco();
```

### 2. **For√ßar Cache**
```javascript
// Preencher cache:
mritDebug.forcarCache();

// Verificar se foi atualizado:
mritDebug.verificarStatusCacheBanco();
```

### 3. **Verificar no Banco**
```sql
-- Consultar status:
SELECT codigo_unico, cache FROM displays WHERE codigo_unico = 'SEU_CODIGO';
```

## Fun√ß√µes Implementadas

### `atualizarStatusCache(codigo, status)`
- Atualiza o campo `cache` na tabela `displays`
- S√≥ funciona quando online
- Logs detalhados de sucesso/erro

### `mritDebug.verificarStatusCacheBanco()`
- Consulta o status atual no banco
- Retorna `true`/`false` ou `undefined` se erro

### `mritDebug.forcarStatusCache(status)`
- For√ßa um status espec√≠fico no banco
- √ötil para testes e corre√ß√µes

## Casos de Uso

### 1. **Monitoramento**
- Verificar quais telas t√™m cache pronto
- Identificar telas que precisam de cache

### 2. **Controle de Qualidade**
- Garantir que cache est√° funcionando
- Detectar problemas de cache

### 3. **Relat√≥rios**
- Estat√≠sticas de cache por tela
- Tempo de disponibilidade offline

## Troubleshooting

### Cache n√£o atualiza no banco
```javascript
// Verificar conex√£o:
mritDebug.verificarStatusCacheBanco();

// For√ßar atualiza√ß√£o:
mritDebug.forcarStatusCache(true);
```

### Status incorreto no banco
```javascript
// Corrigir status:
mritDebug.forcarStatusCache(false); // Limpar
mritDebug.forcarStatusCache(true);  // Marcar como pronto
```

### Verificar logs
- Console do navegador mostra logs detalhados
- Verificar se h√° erros de conex√£o
- Confirmar se o c√≥digo da tela est√° correto

## Exemplo de Uso

```javascript
// 1. Entrar na tela
// 2. Aguardar cache ser preenchido
// 3. Verificar status:
mritDebug.verificarStatusCacheBanco();
// Deve retornar: true

// 4. Sair da tela
// 5. Verificar status novamente:
mritDebug.verificarStatusCacheBanco();
// Deve retornar: false
```

## Notas Importantes

1. **Conex√£o necess√°ria**: Atualiza√ß√£o s√≥ funciona online
2. **C√≥digo da tela**: Deve estar ativo para funcionar
3. **Logs detalhados**: Acompanhe o console para debug
4. **Atualiza√ß√£o autom√°tica**: N√£o precisa fazer nada manualmente
5. **Limpeza autom√°tica**: Status √© limpo ao sair da tela
