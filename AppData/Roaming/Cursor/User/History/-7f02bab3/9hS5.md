# Cache para Vídeos de Alta Qualidade

## Problema Resolvido ✅

### **Limites Anteriores**
- ❌ **Tamanho máximo**: 250MB por vídeo
- ❌ **Timeout**: 10 segundos para download
- ❌ **Vídeos por tela**: 8 vídeos máximo

### **Novos Limites**
- ✅ **Tamanho máximo**: 1GB por vídeo
- ✅ **Timeout**: 30 segundos para download
- ✅ **Vídeos por tela**: 12 vídeos máximo

## Melhorias Implementadas

### **1. Aumento do Limite de Tamanho**
```javascript
// Antes
const MAX_VIDEO_BYTES = 250 * 1024 * 1024; // 250MB

// Agora
const MAX_VIDEO_BYTES = 1024 * 1024 * 1024; // 1GB
```

### **2. Aumento do Timeout**
```javascript
// Antes
const headResp = await netFetch(url, { method: "GET", cache: "no-store" }, 10000);

// Agora
const headResp = await netFetch(url, { method: "GET", cache: "no-store" }, 30000);
```

### **3. Aumento do Limite de Vídeos**
```javascript
// Antes
const MAX_VIDEOS_PER_NS = 8; // 8 vídeos por tela

// Agora
const MAX_VIDEOS_PER_NS = 12; // 12 vídeos por tela
```

### **4. Logs de Debug Melhorados**
```javascript
// Mostra tamanho do vídeo em MB
dlog("vídeo em cache:", url, "tamanho:", blob.size, "MB:", (blob.size / 1024 / 1024).toFixed(2));

// Mostra limite quando é pulado
dlog("pulado (arquivo grande)", url, blob.size, "limite:", MAX_VIDEO_BYTES);
```

## Como Testar

### **1. Ativar Logs de Debug**
```javascript
// No console (F12)
mritDebug.log(true);
```

### **2. Verificar Cache**
```javascript
// Ver vídeos em cache
mritDebug.dump();
```

### **3. Forçar Limpeza e Recache**
```javascript
// Limpar cache e recarregar
mritDebug.clearAll();
location.reload();
```

## Tamanhos Suportados Agora

### **Vídeos de Alta Qualidade**
- **4K (3840x2160)**: Até 1GB
- **1080p (1920x1080)**: Até 1GB
- **720p (1280x720)**: Até 1GB

### **Exemplos de Tamanhos**
- **Vídeo 4K 15min**: ~800MB ✅
- **Vídeo 1080p 30min**: ~600MB ✅
- **Vídeo 720p 45min**: ~400MB ✅
- **Vídeo 4K 30min**: ~1.2GB ❌ (muito grande)

## Monitoramento

### **Logs no Console**
```
[SW] vídeo em cache: https://exemplo.com/video.mp4 tamanho: 1073741824 MB: 1024.00
[SW] pulado (arquivo grande) https://exemplo.com/gigante.mp4 tamanho: 1200000000 limite: 1073741824
```

### **Verificar Status**
```javascript
// Ver se vídeo está em cache
mritDebug.dump();
```

## Vantagens

✅ **Suporte a 4K**: Vídeos de alta qualidade agora ficam em cache  
✅ **Timeout Maior**: 30s para downloads lentos  
✅ **Mais Vídeos**: 12 vídeos por tela  
✅ **Logs Detalhados**: Mostra tamanho e status  
✅ **Performance**: Reprodução instantânea após cache  

## Limitações

⚠️ **Espaço em Disco**: 1GB por vídeo pode ocupar muito espaço  
⚠️ **Tempo de Download**: Vídeos grandes demoram para baixar  
⚠️ **Memória**: Vídeos grandes consomem mais RAM  

## Recomendações

### **Para Vídeos Muito Grandes (>1GB)**
- Use HLS (.m3u8) em vez de MP4
- HLS tem cache de segmentos mais eficiente
- Suporte a qualidade adaptativa

### **Para Otimizar Cache**
- Use vídeos comprimidos (H.264)
- Resolução adequada para a tela
- Duração moderada (5-10min)

Agora vídeos de alta qualidade devem ficar em cache corretamente!
