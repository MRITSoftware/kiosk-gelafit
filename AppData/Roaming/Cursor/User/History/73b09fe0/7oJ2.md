# üì± Como Criar o APK - Guia Completo

## üéØ Objetivo

Criar um APK que instala automaticamente tudo e roda o servidor em segundo plano, sem precisar abrir o Termux manualmente.

## üìã Pr√©-requisitos

1. **Android Studio** (√∫ltima vers√£o)
2. **JDK 11 ou superior**
3. **Android SDK** (via Android Studio)

## üî® Passo a Passo

### 1. Preparar Arquivos

```bash
# No diret√≥rio do projeto
cd android/app/src/main

# Criar pasta assets
mkdir -p assets

# Copiar arquivos necess√°rios
cp ../../../../servidor_auto.py assets/
cp ../../../../iniciar_auto.sh assets/
cp ../../../../parar.sh assets/
cp ../../../../INSTALAR_AUTO.sh assets/
cp ../../../../setup_boot.sh assets/
cp ../../../../requirements.txt assets/
```

### 2. Abrir no Android Studio

1. Abra o Android Studio
2. **File ‚Üí Open** ‚Üí Selecione a pasta `android`
3. Aguarde o Gradle sincronizar

### 3. Compilar APK

**Op√ß√£o A: Interface Gr√°fica**
- **Build ‚Üí Build Bundle(s) / APK(s) ‚Üí Build APK(s)**
- Aguarde a compila√ß√£o
- O APK estar√° em: `app/build/outputs/apk/debug/app-debug.apk`

**Op√ß√£o B: Linha de Comando**
```bash
cd android
./gradlew assembleDebug
```

### 4. Instalar no Tablet

```bash
# Via ADB
adb install app/build/outputs/apk/debug/app-debug.apk

# Ou transfira o APK e instale manualmente
```

## üöÄ Como Funciona

### Fluxo de Instala√ß√£o

1. **Usu√°rio instala o APK**
2. **Abre o app** ‚Üí Tela simples com bot√£o "Instalar"
3. **Clica em "Instalar"** ‚Üí O app:
   - ‚úÖ Verifica se Termux est√° instalado
   - ‚úÖ Se n√£o, abre Play Store para instalar
   - ‚úÖ Copia todos os arquivos para `~/servidorzinho`
   - ‚úÖ Executa `INSTALAR_AUTO.sh` via Termux API
   - ‚úÖ Configura auto-inicializa√ß√£o
   - ‚úÖ Inicia servi√ßo em background

4. **Servi√ßo em Background:**
   - Monitora o servidor a cada 30 segundos
   - Reinicia automaticamente se parar
   - Mostra notifica√ß√£o permanente

### Depois da Instala√ß√£o

- **N√£o precisa abrir Termux**: O servi√ßo inicia automaticamente
- **Reinicia sozinho**: Se o tablet reiniciar, o servi√ßo inicia novamente
- **Monitora conex√£o**: Reinicia se a rede cair

## ‚öôÔ∏è Configura√ß√£o para Kiosque

### Integra√ß√£o com Gelafit Go

O servidor roda em background, ent√£o n√£o interfere com o app principal (`com.mrit.gelafitgo`).

**Para garantir que inicie junto com o tablet:**

1. **Adicione Boot Receiver** (j√° inclu√≠do no c√≥digo)
2. **Configure Launcher Kiosque** no tablet para abrir o Gelafit Go
3. **O servidorzinho inicia automaticamente** em background

### Modo Kiosque Completo

Se quiser que o servidorzinho tamb√©m inicie automaticamente no boot:

1. Adicione ao `AndroidManifest.xml`:
```xml
<receiver android:name=".BootReceiver"
    android:enabled="true"
    android:exported="true">
    <intent-filter>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
    </intent-filter>
</receiver>
```

2. Crie `BootReceiver.java`:
```java
public class BootReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        Intent serviceIntent = new Intent(context, ServerService.class);
        context.startForegroundService(serviceIntent);
    }
}
```

## üîß Personaliza√ß√£o

### Mudar Nome do App

Edite `app/src/main/res/values/strings.xml`:
```xml
<resources>
    <string name="app_name">Servidorzinho</string>
</resources>
```

### Mudar √çcone

Substitua os arquivos em:
- `app/src/main/res/mipmap-hdpi/ic_launcher.png`
- `app/src/main/res/mipmap-mdpi/ic_launcher.png`
- etc.

### Mudar Package Name

1. Edite `app/build.gradle`:
```gradle
applicationId "com.seudominio.installer"
```

2. Mova os arquivos Java para o novo package
3. Atualize `AndroidManifest.xml`

## üì¶ Distribui√ß√£o

### Assinar APK para Produ√ß√£o

1. **Crie keystore:**
```bash
keytool -genkey -v -keystore servidorzinho.keystore -alias servidorzinho -keyalg RSA -keysize 2048 -validity 10000
```

2. **Configure `app/build.gradle`:**
```gradle
android {
    signingConfigs {
        release {
            storeFile file('servidorzinho.keystore')
            storePassword 'sua_senha'
            keyAlias 'servidorzinho'
            keyPassword 'sua_senha'
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled false
        }
    }
}
```

3. **Compile release:**
```bash
./gradlew assembleRelease
```

## üêõ Troubleshooting

### Erro: "Termux API not found"

**Solu√ß√£o**: O Termux precisa estar instalado. O app abre a Play Store automaticamente.

### Servidor n√£o inicia automaticamente

**Solu√ß√£o**: 
1. Abra o Termux manualmente uma vez
2. Execute: `cd ~/servidorzinho && bash iniciar_auto.sh`
3. Depois o servi√ßo Android cuida do resto

### APK muito grande

**Solu√ß√£o**: Os arquivos Python est√£o em `assets/`. Se necess√°rio, compacte ou remova arquivos desnecess√°rios.

### Permiss√µes negadas

**Solu√ß√£o**: 
- V√° em Configura√ß√µes ‚Üí Apps ‚Üí Servidorzinho ‚Üí Permiss√µes
- Ative todas as permiss√µes necess√°rias

## üí° Dicas

1. **Teste primeiro em debug**: Use `app-debug.apk` para testar
2. **Monitore logs**: Use `adb logcat` para ver logs do Android
3. **Verifique Termux**: Certifique-se de que o Termux funciona antes de distribuir
4. **Backup**: Fa√ßa backup do `local_config.json` antes de reinstalar

## üìû Pr√≥ximos Passos

Ap√≥s criar o APK:

1. ‚úÖ Teste em um tablet
2. ‚úÖ Verifique se instala tudo corretamente
3. ‚úÖ Teste reinicializa√ß√£o do tablet
4. ‚úÖ Verifique se o servidor inicia automaticamente
5. ‚úÖ Distribua para clientes

