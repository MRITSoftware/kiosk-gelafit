# ğŸ¤– Sistema de AutomaÃ§Ã£o de Geladeiras

Sistema completo para automaÃ§Ã£o de abertura de geladeiras via WhatsApp, integrado com pagamentos do Mercado Pago e dispositivos IoT.

## ğŸš€ Funcionalidades

### Fluxo Principal
- âœ… Recebimento de mensagens via WhatsApp (webhook)
- âœ… Menu interativo com opÃ§Ãµes (Abrir geladeira / Pagamento / Outros)
- âœ… Upload de comprovantes de pagamento (imagem)
- âœ… ValidaÃ§Ã£o de pagamentos via API do Mercado Pago
- âœ… SeleÃ§Ã£o de unidade por cÃ³digo
- âœ… Envio de comandos para dispositivos IoT (MQTT/REST/Database)
- âœ… ConfirmaÃ§Ã£o de abertura da geladeira
- âœ… Encaminhamento para suporte humano quando necessÃ¡rio

### IntegraÃ§Ãµes
- âœ… **WhatsApp Cloud API** - Mensagens e webhooks
- âœ… **Mercado Pago** - ValidaÃ§Ã£o de pagamentos
- âœ… **Supabase Storage** - Armazenamento de comprovantes
- âœ… **PostgreSQL** - Banco de dados principal
- âœ… **Redis** - Cache e sessÃµes
- âœ… **MQTT** - ComunicaÃ§Ã£o com dispositivos IoT

### Recursos AvanÃ§ados
- âœ… Sistema de sessÃµes com Redis
- âœ… Rate limiting por usuÃ¡rio
- âœ… Bloqueio de nÃºmeros suspeitos
- âœ… Logs de auditoria completos
- âœ… Health checks para todos os serviÃ§os
- âœ… Tratamento de erros robusto
- âœ… Suporte a retry automÃ¡tico
- âœ… Upload otimizado de imagens

## ğŸ› ï¸ Tecnologias

- **Backend**: Node.js + TypeScript + Express
- **Banco de Dados**: PostgreSQL + Prisma ORM
- **Cache**: Redis
- **Storage**: Supabase Storage
- **MQTT**: mqtt.js
- **Pagamentos**: Mercado Pago SDK
- **WhatsApp**: Graph API oficial

## ğŸ“‹ PrÃ©-requisitos

- Node.js 18+
- PostgreSQL 13+
- Redis 6+
- Conta WhatsApp Business
- Conta Mercado Pago
- Conta Supabase

## âš™ï¸ InstalaÃ§Ã£o

1. **Clone o repositÃ³rio**
```bash
git clone <repository-url>
cd automatizador
```

2. **Instale as dependÃªncias**
```bash
npm install
```

3. **Configure as variÃ¡veis de ambiente**
```bash
cp env.example .env
# Edite o arquivo .env com suas credenciais
```

4. **Configure o banco de dados**
```bash
npx prisma generate
npx prisma db push
```

5. **Execute as migraÃ§Ãµes**
```bash
npx prisma migrate dev
```

6. **Inicie o servidor**
```bash
npm run dev
```

## ğŸ”§ ConfiguraÃ§Ã£o

### VariÃ¡veis de Ambiente ObrigatÃ³rias

```env
# Servidor
PORT=3000
NODE_ENV=development

# WhatsApp Cloud API
WHATSAPP_TOKEN=your_whatsapp_token
WHATSAPP_PHONE_NUMBER_ID=your_phone_number_id
WHATSAPP_WEBHOOK_VERIFY_TOKEN=your_webhook_verify_token

# Mercado Pago
MERCADOPAGO_ACCESS_TOKEN=your_mercadopago_access_token
MERCADOPAGO_PUBLIC_KEY=your_mercadopago_public_key

# Banco de Dados
DATABASE_URL=postgresql://username:password@localhost:5432/automatizador_geladeira

# Redis
REDIS_URL=redis://localhost:6379

# Supabase Storage
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# MQTT (opcional)
MQTT_BROKER_URL=mqtt://localhost:1883
```

### ConfiguraÃ§Ã£o do WhatsApp

1. Acesse o [Facebook Developers](https://developers.facebook.com/)
2. Crie uma aplicaÃ§Ã£o WhatsApp Business
3. Configure o webhook: `https://seu-dominio.com/webhook/whatsapp`
4. Obtenha o token de acesso e ID do nÃºmero de telefone

### ConfiguraÃ§Ã£o do Mercado Pago

1. Acesse o [Mercado Pago Developers](https://www.mercadopago.com.br/developers)
2. Crie uma aplicaÃ§Ã£o
3. Obtenha as credenciais de sandbox e produÃ§Ã£o
4. Configure o webhook para notificaÃ§Ãµes

### ConfiguraÃ§Ã£o do Supabase

1. Crie um projeto no [Supabase](https://supabase.com/)
2. Configure o bucket `comprovantes` no Storage
3. Obtenha as chaves de API

## ğŸ“± Como Usar

### Fluxo do Cliente

1. **Cliente envia mensagem** para o nÃºmero WhatsApp Business
2. **Bot responde** com menu interativo
3. **Cliente escolhe** "Abrir Geladeira"
4. **Cliente envia** comprovante de pagamento (foto ou cÃ³digo)
5. **Sistema valida** pagamento no Mercado Pago
6. **Cliente seleciona** unidade por cÃ³digo
7. **Sistema envia** comando para dispositivo IoT
8. **Cliente confirma** se a geladeira abriu
9. **Processo finalizado** ou encaminhado para suporte

### Endpoints da API

- `GET /` - InformaÃ§Ãµes da aplicaÃ§Ã£o
- `GET /health` - Health check completo
- `GET /webhook/whatsapp` - VerificaÃ§Ã£o do webhook WhatsApp
- `POST /webhook/whatsapp` - Recebimento de mensagens
- `POST /test/whatsapp/send` - Envio de mensagem de teste
- `GET /stats/whatsapp` - EstatÃ­sticas do WhatsApp

## ğŸ—ï¸ Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WhatsApp      â”‚    â”‚   Backend API   â”‚    â”‚   Dispositivos  â”‚
â”‚   Cloud API     â”‚â—„â”€â”€â–ºâ”‚   (Node.js)     â”‚â—„â”€â”€â–ºâ”‚   IoT/MQTT      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                       â”‚             â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚Postgres â”‚  â”‚  Redis  â”‚
                  â”‚(Supabase)â”‚  â”‚ (Cache) â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”’ SeguranÃ§a

- âœ… ValidaÃ§Ã£o de webhooks
- âœ… Rate limiting por usuÃ¡rio
- âœ… Bloqueio de nÃºmeros suspeitos
- âœ… Criptografia de dados sensÃ­veis
- âœ… Logs de auditoria
- âœ… ValidaÃ§Ã£o de entrada
- âœ… Headers de seguranÃ§a

## ğŸ“Š Monitoramento

- âœ… Health checks para todos os serviÃ§os
- âœ… Logs estruturados
- âœ… MÃ©tricas de performance
- âœ… Alertas de erro
- âœ… EstatÃ­sticas de uso

## ğŸ§ª Testes

```bash
# Executar testes
npm test

# Teste de integraÃ§Ã£o
npm run test:integration

# Teste de carga
npm run test:load
```

## ğŸš€ Deploy

### Vercel
```bash
npm install -g vercel
vercel --prod
```

### Railway
```bash
npm install -g @railway/cli
railway login
railway up
```

### Docker
```bash
docker build -t automatizador-geladeira .
docker run -p 3000:3000 automatizador-geladeira
```

## ğŸ“ˆ Melhorias Futuras

- [ ] Dashboard administrativo
- [ ] OCR para extrair cÃ³digos de pagamento automaticamente
- [ ] Suporte a mÃºltiplos idiomas
- [ ] IntegraÃ§Ã£o com outros gateways de pagamento
- [ ] Sistema de notificaÃ§Ãµes push
- [ ] Analytics avanÃ§ados
- [ ] API para terceiros

## ğŸ¤ ContribuiÃ§Ã£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a MIT. Veja o arquivo `LICENSE` para mais detalhes.

## ğŸ“ Suporte

Para suporte tÃ©cnico ou dÃºvidas:
- ğŸ“§ Email: suporte@exemplo.com
- ğŸ’¬ WhatsApp: +55 11 99999-9999
- ğŸ› Issues: [GitHub Issues](https://github.com/seu-usuario/automatizador/issues)

---

**Desenvolvido com â¤ï¸ para automatizar geladeiras via WhatsApp**
