# Sistema de Cupons com QR Code

Este sistema permite criar e gerenciar cupons com QR Code para promo√ß√µes.

## üìÅ Estrutura de Arquivos

```
public/promos/
‚îú‚îÄ‚îÄ promo_qr.html      # P√°gina de cria√ß√£o de cupons
‚îú‚îÄ‚îÄ promo_show.html    # P√°gina p√∫blica da promo√ß√£o
‚îú‚îÄ‚îÄ config.js          # Configura√ß√£o do Supabase
‚îî‚îÄ‚îÄ README.md          # Este arquivo
```

## üöÄ Configura√ß√£o

### 1. Configurar Supabase

1. **Criar tabela `promo`:**
   ```sql
   -- Execute o script em database/create_promo_table.sql
   ```

2. **Criar bucket `promos` no Storage:**
   - Acesse o painel do Supabase
   - V√° em Storage > Create bucket
   - Nome: `promos`
   - P√∫blico: Sim

3. **Configurar credenciais:**
   - Edite `config.js`
   - Substitua `your-project.supabase.co` pela URL do seu projeto
   - Substitua `your-anon-key` pela chave an√¥nima do seu projeto

### 2. Configurar Pol√≠ticas RLS (Row Level Security)

```sql
-- Habilitar RLS na tabela promo
ALTER TABLE promo ENABLE ROW LEVEL SECURITY;

-- Pol√≠tica para leitura p√∫blica (necess√°rio para promo_show.html)
CREATE POLICY "Promo√ß√µes s√£o p√∫blicas para leitura" ON promo
    FOR SELECT USING (true);

-- Pol√≠tica para inser√ß√£o (apenas usu√°rios autenticados)
CREATE POLICY "Usu√°rios autenticados podem criar promo√ß√µes" ON promo
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');
```

### 3. Configurar Storage

```sql
-- Pol√≠tica para upload de imagens QR
CREATE POLICY "Upload de QR codes" ON storage.objects
    FOR INSERT WITH CHECK (bucket_id = 'promos');

-- Pol√≠tica para leitura p√∫blica de QR codes
CREATE POLICY "QR codes s√£o p√∫blicos" ON storage.objects
    FOR SELECT USING (bucket_id = 'promos');
```

## üéØ Como Usar

### 1. Criar Cupom
1. Acesse `/promos/promo_qr.html`
2. Preencha o formul√°rio:
   - **Nome do Cupom** (obrigat√≥rio)
   - **C√≥digo** (opcional - gerado automaticamente se vazio)
   - **Valor/Desconto** (opcional)
   - **Descri√ß√£o** (opcional)
3. Clique em "Gerar Cupom"
4. O sistema ir√°:
   - Gerar ID √∫nico da promo√ß√£o
   - Criar link p√∫blico
   - Gerar QR Code
   - Fazer upload da imagem para o Supabase
   - Salvar no banco de dados

### 2. Visualizar Cupom
1. Acesse o link p√∫blico gerado
2. A p√°gina `promo_show.html` ser√° carregada
3. Mostra:
   - C√≥digo da promo√ß√£o
   - Descri√ß√£o
   - Valor (se informado)
   - QR Code
   - Op√ß√µes de download

### 3. Integra√ß√£o com Painel
- O bot√£o "QR Code" na p√°gina de An√∫ncios abre a p√°gina de cria√ß√£o
- Funciona em nova aba para n√£o interromper o fluxo principal

## üé® Recursos

### P√°gina de Cria√ß√£o (promo_qr.html)
- ‚úÖ Formul√°rio intuitivo
- ‚úÖ Gera√ß√£o autom√°tica de QR Code
- ‚úÖ Upload autom√°tico para Supabase Storage
- ‚úÖ Preview visual do cupom
- ‚úÖ Download em PNG (normal e TV 40")
- ‚úÖ Links copi√°veis
- ‚úÖ Design responsivo

### P√°gina P√∫blica (promo_show.html)
- ‚úÖ Design otimizado para mobile
- ‚úÖ Carregamento autom√°tico da promo√ß√£o
- ‚úÖ QR Code funcional
- ‚úÖ Download de imagens
- ‚úÖ Op√ß√£o de download autom√°tico
- ‚úÖ Tratamento de erros

## üîß Personaliza√ß√£o

### Cores e Estilo
- Edite as vari√°veis CSS nas p√°ginas HTML
- Gradientes principais: `#667eea` ‚Üí `#764ba2`
- Cores de destaque: `#28a745` (sucesso), `#dc3545` (erro)

### Funcionalidades
- Adicione campos personalizados na tabela `promo`
- Modifique o formul√°rio em `promo_qr.html`
- Ajuste a exibi√ß√£o em `promo_show.html`

## üêõ Troubleshooting

### Problemas Comuns

1. **"Promo√ß√£o n√£o encontrada"**
   - Verifique se a tabela `promo` existe
   - Confirme as pol√≠ticas RLS
   - Verifique se o ID da promo√ß√£o est√° correto

2. **Erro ao fazer upload da imagem**
   - Verifique se o bucket `promos` existe
   - Confirme as pol√≠ticas de Storage
   - Verifique as credenciais do Supabase

3. **QR Code n√£o aparece**
   - Verifique se a biblioteca QRCode est√° carregada
   - Confirme se o link p√∫blico est√° correto

### Logs de Debug
- Abra o Console do navegador (F12)
- Verifique erros de JavaScript
- Confirme requisi√ß√µes para o Supabase

## üì± Responsividade

- ‚úÖ Mobile first
- ‚úÖ Breakpoints: 768px, 1024px
- ‚úÖ Layout adaptativo
- ‚úÖ Bot√µes touch-friendly
- ‚úÖ Texto leg√≠vel em todas as telas

## üîí Seguran√ßa

- ‚úÖ RLS habilitado na tabela `promo`
- ‚úÖ Pol√≠ticas de Storage configuradas
- ‚úÖ Valida√ß√£o de dados no frontend
- ‚úÖ Sanitiza√ß√£o de inputs
- ‚úÖ Tratamento de erros

## üöÄ Pr√≥ximos Passos

- [ ] Adicionar autentica√ß√£o na p√°gina de cria√ß√£o
- [ ] Implementar edi√ß√£o de cupons existentes
- [ ] Adicionar estat√≠sticas de uso
- [ ] Criar templates de cupons
- [ ] Implementar expira√ß√£o de cupons
- [ ] Adicionar c√≥digos de barras
- [ ] Integrar com sistema de notifica√ß√µes
