# üì± Guia Completo - Tablet 24h

## üéØ Objetivo
Configurar o servidorzinho para rodar 24h em um tablet Android, reiniciando automaticamente ap√≥s quedas de energia ou internet.

## üì¶ Instala√ß√£o Completa

### Passo 1: Instalar no Termux
```bash
cd ~/servidorzinho
bash INSTALAR_AUTO.sh
```

### Passo 2: Configurar Inicializa√ß√£o Autom√°tica

**Op√ß√£o A: Usar Automate (Recomendado - Mais Confi√°vel)**

1. Instale o app **Automate** (gratuito na Play Store)
2. Abra o Automate
3. Toque em **"+"** ‚Üí **"Create flow"**
4. Arraste os blocos:

   ```
   [Device boot] ‚Üí [Shell command]
   ```

5. Configure o bloco "Shell command":
   - **Command**: `bash`
   - **Arguments**: `~/servidorzinho/iniciar_auto.sh`
   - **Working directory**: `~/servidorzinho`

6. Salve e ative o fluxo

**Op√ß√£o B: Usar Script do Termux (Mais Simples)**

```bash
cd ~/servidorzinho
bash setup_boot.sh
```

Isso configura o Termux para iniciar automaticamente quando abrir.

### Passo 3: Testar

1. Reinicie o tablet
2. Aguarde 1-2 minutos
3. Verifique se est√° rodando:
   ```bash
   ps aux | grep servidor_auto
   ```
4. Ou veja os logs:
   ```bash
   tail -f ~/servidorzinho/servidor.log
   ```

## üîÑ Como Funciona o Auto-Rein√≠cio

O `servidor_auto.py` monitora a conex√£o de rede a cada 30 segundos:

- ‚úÖ **Rede OK**: Continua rodando normalmente
- ‚ö†Ô∏è **Rede caiu**: Conta tentativas (at√© 3)
- üîÑ **Ap√≥s 3 falhas**: Reinicia automaticamente o servidor
- ‚úÖ **Rede volta**: Continua funcionando normalmente

## üìä Monitoramento

### Ver Status
```bash
curl http://localhost:8080/status
```

### Ver Logs em Tempo Real
```bash
tail -f ~/servidorzinho/servidor.log
```

### Verificar se Est√° Rodando
```bash
ps aux | grep servidor_auto
```

### Ver √öltimas 50 Linhas do Log
```bash
tail -50 ~/servidorzinho/servidor.log
```

## üõ†Ô∏è Comandos √öteis

### Iniciar Manualmente
```bash
servidor-auto
```

### Parar
```bash
servidor-parar
```

### Reiniciar
```bash
servidor-parar
servidor-auto
```

### Verificar Porta
```bash
netstat -tulpn | grep 8080
```

## ‚öôÔ∏è Configura√ß√µes Avan√ßadas

### Mudar Intervalo de Verifica√ß√£o
Edite `servidor_auto.py`:
```python
CHECK_INTERVAL = 60  # Verifica a cada 60 segundos (padr√£o: 30)
```

### Mudar N√∫mero de Tentativas
Edite `servidor_auto.py`:
```python
MAX_RETRIES = 5  # Tenta 5 vezes antes de reiniciar (padr√£o: 3)
```

### Mudar Nome do Site
Edite `local_config.json` ou use vari√°vel de ambiente:
```bash
export SITE_NAME="Cozinha"
bash iniciar_auto.sh
```

## üö® Troubleshooting

### Servidor n√£o inicia ap√≥s reiniciar tablet

**Solu√ß√£o 1**: Verifique se o Automate est√° rodando
- Abra o Automate
- Veja se o fluxo est√° ativo (verde)

**Solu√ß√£o 2**: Verifique permiss√µes do Termux
- V√° em Configura√ß√µes ‚Üí Apps ‚Üí Termux ‚Üí Permiss√µes
- Ative todas as permiss√µes necess√°rias

**Solu√ß√£o 3**: Inicie manualmente
```bash
cd ~/servidorzinho
bash iniciar_auto.sh
```

### Servidor para sozinho

1. Verifique os logs:
   ```bash
   tail -100 servidor.log
   ```

2. Verifique se h√° erros de mem√≥ria:
   ```bash
   free -h
   ```

3. Reinicie manualmente:
   ```bash
   servidor-parar
   servidor-auto
   ```

### Porta 8080 j√° em uso

```bash
# Encontre o processo
netstat -tulpn | grep 8080

# Mate o processo
kill <PID>
```

### Internet cai mas servidor n√£o reinicia

O servidor verifica a **rede local**, n√£o a internet. Se a rede local (Wi-Fi) estiver ativa, ele continua rodando mesmo sem internet externa.

Para verificar rede local:
```bash
ping -c 1 192.168.1.1  # Substitua pelo IP do seu roteador
```

## üí° Dicas

1. **Mantenha o Termux aberto**: Se poss√≠vel, deixe o Termux minimizado (n√£o fechado) para garantir que o servidor continue rodando.

2. **Use um widget**: Alguns apps permitem criar widgets que abrem o Termux rapidamente.

3. **Monitore periodicamente**: Configure um alerta para verificar se o servidor est√° rodando (pode usar IFTTT ou similar).

4. **Backup da config**: Fa√ßa backup do `local_config.json` periodicamente:
   ```bash
   cp local_config.json local_config.json.backup
   ```

## üìû Suporte

Se tiver problemas:
1. Verifique os logs: `tail -100 servidor.log`
2. Verifique se est√° rodando: `ps aux | grep servidor_auto`
3. Tente reiniciar: `servidor-parar && servidor-auto`

